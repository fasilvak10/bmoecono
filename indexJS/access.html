<script>
  var dataUser;
  var session;

  function enviarFormulario(form) {
    event.preventDefault();
    mensajeError.hidden = true;
    const button = document.getElementById('submitLogin');

    loadingshow();
    google.script.run
      .withSuccessHandler(async (usuario) => {
        console.log(usuario);
        document.getElementById('saludoUsuario').innerHTML = `Hola ${usuario[0].completeName}!`;
        dataUser = usuario[0];
        session = dataUser.timeSession;
        console.log(session)
        //verificarSesion();

        // Esperar a que GetData termine
        GetData();

        const loginElement = document.getElementById("login");
        if (loginElement) {
          loginElement.hidden = true;
        }

        reglasOnboarding();
        animarCards();
        const onboarding = document.getElementById("onboarding");
        if(usuario[0].checkin === true) {
          const imgSrc = usuario[0].linkCharacter
          mostrarPersonajeSeleccionado(imgSrc);
          onboarding.hidden = true;
          showWelcomeAnimation();

        };
        
        
      })
      .withFailureHandler(showError)
      .verificarPassword(form);
  }


  function showError(error){
    loadingshow();
    const mensajeError = document.getElementById('mensajeError');
    mensajeError.hidden = false;
    const button = document.getElementById('submitLogin');
    button.disabled = false;         
  }

  function loadingshow(){
    document.querySelector('#submitLogin').classList.toggle("d-none");
    document.querySelector('#LoadingButton02').classList.toggle("d-none");


  }

  function loadingCharge(botonOriginal, botonLoading) {

    botonOriginal.classList.add('d-none');
    botonLoading.classList.remove('d-none');

  }

  function loadArtwork() {
    google.script.run.withSuccessHandler(function(data) {
      const artworkImage = document.getElementById('artwork-image');
      const artworkTitle = document.getElementById('artwork-title');
      
      artworkImage.src = data.imageUrl;
      artworkTitle.textContent = data.title;
    }).withFailureHandler(function(error) {
      console.error('Error al cargar la obra de arte:', error);
    }).getArtwork();
  }

  // Cargar la obra al inicializar la página
  //loadArtwork();

  function getRandomImage(){
    const obras = [
    'https://www.bellasartes.gob.ar/media/uploads/coleccion/10663.jpg', 
    'https://www.bellasartes.gob.ar/media/uploads/coleccion/5991.jpg',
    'https://www.bellasartes.gob.ar/media/uploads/coleccion/7122.jpg', 
    'https://www.bellasartes.gob.ar/media/uploads/coleccion/2694.jpg',
    'https://www.bellasartes.gob.ar/media/uploads/coleccion/10696.jpg', 
    'https://www.bellasartes.gob.ar/media/uploads/coleccion/10661.jpg',
    'https://www.bellasartes.gob.ar/media/uploads/coleccion/5869.jpg', 
    'https://www.bellasartes.gob.ar/media/uploads/coleccion/6297.jpg',
    'https://www.bellasartes.gob.ar/media/uploads/coleccion/5293.jpg'    
    ]

    const randomIndex = Math.floor(Math.random() * obras.length);
    return obras[randomIndex];
  }

  function setRandomBackgroundImage() {
    const imgElement = document.getElementById('backgroundImage');
    //imgElement.src = getRandomImage();
  }

  //setRandomBackgroundImage();


  document.addEventListener('DOMContentLoaded', () => {
    // Seleccionar solo los botones "Elegíme!" dentro del #onboarding
    const onboarding = document.getElementById('onboarding');
    const botones = onboarding.querySelectorAll('.card .btn.btn-outline-primary');

    botones.forEach(boton => {
      boton.addEventListener('click', (event) => {
        event.preventDefault(); // Evitar el comportamiento del <a>

        const card = boton.closest('.card');
        const imgSrc = card.querySelector('img').getAttribute('src');
        const nombre = card.querySelector('.card-title').textContent;

        // Tu lógica personalizada con los datos
        console.log('Seleccionado:', nombre);
        console.log('Imagen:', imgSrc);

        seleccionarPersonaje(nombre, imgSrc); // Llamá a tu función
      });
    });
  });

  function seleccionarPersonaje(nombre, imgSrc) {
    console.log(`Elegiste a: ${nombre}\nImagen: ${imgSrc}`);
    const usuario = dataUser.name;

    // Ocultar el onboarding
    mostrarPersonajeSeleccionado(imgSrc);
    document.getElementById('onboarding').hidden = true;
    launchConfetti();

    google.script.run
      .withSuccessHandler(() => {
        
      })
      .withFailureHandler((error) => {
        console.error('Error al seleccionar personaje:', error.message);
      })
      .selectedCharacter(usuario, nombre, imgSrc);
  }

  function mostrarPersonajeSeleccionado(imgSrc) {
    console.log('Personaje seleccionado correctamente');
    const personajeImg = document.getElementById("character_selector");
    
    personajeImg.src = imgSrc;

    // Reiniciar la animación si ya se había usado antes
    personajeImg.classList.remove("img-slide-up");
    void personajeImg.offsetWidth; // Trigger reflow
    personajeImg.classList.add("img-slide-up");

    //toggleInfo();
    iniciarTypedUnaVez();
  }




</script>